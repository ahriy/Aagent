# 🎯 价值投资Agent - 智能股票筛选系统

## 📖 系统简介

价值投资Agent融合了三位投资大师的投资理念：
- **🏆 巴菲特标准**：护城河、持续盈利、低债务、合理估值
- **🧠 芒格标准**：质量优先、理性分析、长期视角、反向思维  
- **📚 格雷厄姆标准**：安全边际、价值发现、基本面分析、PE估值

## ✨ 核心特性

### 🚀 智能两阶段筛选
1. **初步筛选**：基于历史财务数据，快速筛选候选股票（不调用API）
2. **最终评估**：对有潜力股票获取实时PE，进行精准评估（智能API调用）

### 📡 实时PE支持
- 自动获取Tushare实时PE数据
- 多Token智能切换和重试机制
- API调用频率控制，避免限制
- 优先使用实时PE，回退到历史PE

### 🎯 评分体系
- 巴菲特标准 40%权重
- 芒格标准 30%权重  
- 格雷厄姆标准 30%权重
- 综合评分 0-100分，智能分级

## 🔧 配置要求

### 1. Tushare配置
创建 `config.json` 文件：
```json
{
    "tushare_tokens": [
        "your_tushare_token_1",
        "your_tushare_token_2"
    ]
}
```

### 2. 依赖安装
```bash
pip install tushare pandas numpy loguru sqlite3
```

### 3. 数据库
需要 `stock_analysis.db` 数据库，包含：
- `stocks` 表：股票基本信息
- `financial_metrics` 表：财务指标数据

## 🎮 使用方法

### 分析单个股票
```bash
# 基础分析（使用实时PE）
python value_investment_agent.py --stock-code 000001

# 不使用实时PE（节省API调用）
python value_investment_agent.py --stock-code 000001 --no-realtime-pe
```

### 批量筛选价值股票
```bash
# 默认筛选
python value_investment_agent.py

# 自定义参数
python value_investment_agent.py \
    --min-score 65 \
    --preliminary-threshold 50 \
    --limit 20 \
    --output my_report.md
```

### 参数说明
- `--min-score`: 最终最低投资分数 (默认60)
- `--preliminary-threshold`: 初步筛选阈值 (默认45)  
- `--limit`: 筛选股票数量限制 (默认30)
- `--stock-code`: 分析单个股票代码
- `--output`: 报告输出文件名
- `--no-realtime-pe`: 禁用实时PE获取

## 📊 输出示例

### 单股票分析
```
🎯 平安银行 (000001)
📊 综合评分: 72.5/100 - A 推荐买入
🏭 所属行业: 银行
💡 实时PE: 5.23

🏆 巴菲特分析 (75/100):
   🌟 卓越ROE: 11.2% (>10%)
   💪 低债务负担: 8.5% (<20%)
   📈 持续盈利: 净利率 28.3%
   ✅ 合理估值: PE 5.2x (<18, 实时)

🧠 芒格分析 (68/100):
   🎯 优质行业: 银行
   ✅ 运营良好: 资产周转率 0.18
   💰 合理估值: PE 5.2x (<15, 实时)

📚 格雷厄姆分析 (75/100):
   🎯 低估值: PE 5.2x (<10, 实时)
   ✅ 低PB: 0.67x (<2)
   💰 高股息: 4.8% (>4%)
```

### 批量筛选结果
```
🌟 发现 15 只价值股票:
────────────────────────────────────────────────────────────────────────────────────────────────────
序号   股票名称   代码     评分  等级      实时PE   行业    
────────────────────────────────────────────────────────────────────────────────────────────────────
 1.   招商银行   600036   78.5  A 推荐买入    6.2     银行    
 2.   平安银行   000001   72.5  A 推荐买入    5.2     银行    
 3.   兴业银行   601166   69.8  B+ 值得关注   4.8     银行    
...

📊 本次筛选统计:
   - 使用实时PE: 12/15 只
   - 平均评分: 68.3
```

## 🧪 测试功能

运行测试脚本验证功能：
```bash
python test_realtime_pe.py
```

## 🔄 筛选流程

1. **数据库查询**：获取所有股票基本信息
2. **初步筛选**：基于ROE、债务率、毛利率等历史指标筛选
3. **候选排序**：按初步得分排序，选择前N只进行API评估
4. **实时PE获取**：调用Tushare API获取最新PE数据
5. **最终评估**：结合实时PE重新计算综合评分
6. **结果输出**：生成详细分析报告

## 📈 评分标准详解

### 巴菲特标准 (40%权重)
- ROE > 20%: +25分，ROE > 15%: +15分
- 债务率 < 20%: +20分，< 30%: +10分
- 持续盈利: +15分
- 流动性充裕: +10分
- 实时PE < 12: +25分，< 18: +15分

### 芒格标准 (30%权重)  
- 优质行业: +15分
- 高效运营（资产周转率 > 0.8）: +15分
- 高毛利率（> 40%）: +20分
- 毛利率上升趋势: +10分
- 合理估值（PE < 15）: +15分

### 格雷厄姆标准 (30%权重)
- PE < 10: +25分，< 15: +15分，< 20: +5分
- PB < 1: +20分，< 2: +10分，< 3: +5分
- 股息率 > 4%: +15分，> 2%: +10分
- 流动比率 > 2: +15分，> 1.5: +10分
- 资产正增长: +5-10分

## ⚠️ 重要提醒

1. **投资风险**：本系统仅供参考，投资有风险，入市需谨慎
2. **数据时效**：历史数据不代表未来表现  
3. **API限制**：Tushare有API调用频率限制，合理使用
4. **多维分析**：建议结合其他分析工具综合判断
5. **长期视角**：价值投资注重长期持有，避免短期投机

## 🔧 技术架构

- **数据源**：SQLite本地数据库 + Tushare实时API
- **评估引擎**：多维度评分算法
- **智能调度**：两阶段筛选减少API调用
- **容错机制**：多Token切换、自动重试
- **报告生成**：Markdown格式详细报告

---
*价值投资Agent - 让投资更智能，让选股更科学* 🚀 